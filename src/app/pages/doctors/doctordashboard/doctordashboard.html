<div class="doctor-dashboard">
  <header class="hdr">
    <div class="left">
      <h2>ğŸ‘¨â€âš•ï¸ Panel del MÃ©dico</h2>
      <p class="subtitle" *ngIf="doctor">
        Dr. {{ doctorNombre }} â€” {{ doctor.especialidad?.nombreEspecialidad || doctor.especialidad || '' }}
      </p>
    </div>

    <div class="right">
      <button class="primary" routerLink="/doctor/specialitys">âœï¸ Elegir especialidad</button>
    </div>
  </header>

  <section class="summary" *ngIf="!loading">
    <div class="card">
      <div class="big">{{ totalPendientes }}</div>
      <div class="label">Citas pendientes</div>
    </div>
    <div class="card">
      <div class="big">{{ totalCompletadas }}</div>
      <div class="label">Citas completadas</div>
    </div>
  </section>

  <div *ngIf="loading" class="loading">â³ Cargando datos...</div>
  <div *ngIf="mensaje" class="mensaje">{{ mensaje }}</div>

  <section *ngIf="!loading">
    <h3>PrÃ³ximas citas</h3>
    <table *ngIf="citasProximas.length > 0" class="table">
      <thead>
        <tr>
          <th>Paciente</th><th>Fecha</th><th>Hora</th><th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of citasProximas">
          <td>{{ c.paciente?.nombre || c.paciente?.usuario?.nombre }} {{ c.paciente?.apellido || c.paciente?.usuario?.apellido }}</td>
          <td>{{ c.fechaCita | date:'yyyy-MM-dd' }}</td>
          <td>{{ c.horaCita }}</td>
          <td class="acciones">
            <button (click)="completarCita(c.idCita)">âœ… Completar</button>
            <button (click)="cancelarCita(c.idCita)">âŒ Cancelar</button>
            <button (click)="marcarNoAsistio(c.idCita)">ğŸš« No asistiÃ³</button>
          </td>
        </tr>
      </tbody>
    </table>
    <p *ngIf="citasProximas.length === 0">No hay citas prÃ³ximas.</p>
  </section>

  <section *ngIf="!loading" class="past-block">
    <h3>Citas pasadas</h3>
    <table *ngIf="citasPasadas.length > 0" class="table">
      <thead>
        <tr><th>Paciente</th><th>Fecha</th><th>Hora</th><th>Estado</th></tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of citasPasadas">
          <td>{{ c.paciente?.nombre || c.paciente?.usuario?.nombre }} {{ c.paciente?.apellido || c.paciente?.usuario?.apellido }}</td>
          <td>{{ c.fechaCita | date:'yyyy-MM-dd' }}</td>
          <td>{{ c.horaCita }}</td>
          <td>{{ c.estado }}</td>
        </tr>
      </tbody>
    </table>
    <p *ngIf="citasPasadas.length === 0">No hay citas pasadas.</p>
  </section>
</div>
